# ğŸš¨ Ø­Ù„ Ù†Ù‡Ø§Ø¦ÙŠ Ù„Ù…Ø´ÙƒÙ„Ø© 409 ÙÙŠ Subscriptions

## âŒ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:
```json
{
  "code": "error.data.integrity",
  "message": "Data integrity violation",
  "status": 409
}
```

---

## ğŸ¯ Ø§Ù„Ø³Ø¨Ø¨ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ (99% Ù…ØªØ£ÙƒØ¯):

### Ø§Ù„Ù€ **Tenant** ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!

Ø¹Ù†Ø¯Ù…Ø§ ØªØ­Ø§ÙˆÙ„ Ø¥Ø¶Ø§ÙØ© subscriptionØŒ Ø§Ù„Ù€ Backend ÙŠØªØ­Ù‚Ù‚ Ù…Ù†:
```sql
FOREIGN KEY (tenant_id) REFERENCES tenants(tenant_id)
```

Ø¥Ø°Ø§ Ø§Ù„Ù€ `tenant_id` Ù…Ø´ Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø¬Ø¯ÙˆÙ„ `tenants` â†’ **409 error**!

---

## âœ… Ø§Ù„Ø­Ù„ Ø§Ù„Ø³Ø±ÙŠØ¹ (Ø§Ø®ØªØ± ÙˆØ§Ø­Ø¯):

### Ø§Ù„Ø­Ù„ 1: Ø£Ø¶Ù Ù…Ù† ØµÙØ­Ø© Tenants List (Ø§Ù„Ø£Ø³Ù‡Ù„!)

```bash
# 1. Ø±ÙˆØ­ Ø¹Ù„Ù‰ Tenants List
http://localhost:5173/cms/tenants

# 2. Ø§Ø¶ØºØ· "Add New" (ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰)

# 3. Ø§Ù…Ù„Ø£ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:
Tenant Name:      UNHCR
Email:            ma@gmail.com
Industry Type:    [Ø§Ø®ØªØ±]
Subscription Plan: [Ø§Ø®ØªØ±]
Billing Currency: Dollar    â† Ù…Ù‡Ù…!
Country:          Jordan    â† Ù…Ù‡Ù…!
... Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø­Ù‚ÙˆÙ„

# 4. Ø§Ø¶ØºØ· Save

# 5. Ø§Ù„Ø¢Ù† Ø§ÙØªØ­ Ø§Ù„Ù€ Tenant Ø§Ù„Ù„ÙŠ Ø£Ù†Ø´Ø£ØªÙ‡

# 6. Ø±ÙˆØ­ Ø¹Ù„Ù‰ tab "Subscriptions"

# 7. Ø§Ø¶ØºØ· "Add New" ÙˆØ£Ø¶Ù subscription
```

---

### Ø§Ù„Ø­Ù„ 2: Ø£Ù†Ø´Ø¦ Ø§Ù„Ù€ Tenant Ù…Ù† Database

```sql
-- Ù†ÙÙ‘Ø° Ù‡Ø°Ø§ SQL:
INSERT INTO tenants (
    tenant_id,
    name,
    email,
    billing_currency_id,
    country_id,
    is_active,
    is_deleted,
    created_at,
    row_version
) VALUES (
    '0bf65997-ac37-40e2-b54d-1fe71d3dcb40',  -- Ù†ÙØ³ Ø§Ù„Ù€ UUID
    'UNHCR',
    'ma@gmail.com',
    '606943f0-a3ba-4449-a80f-0fab3b6dc5c1',  -- Dollar
    'd1006514-0088-473b-8990-68f564cfa7f2',  -- Jordan
    true,
    false,
    NOW(),
    0
) ON CONFLICT (tenant_id) DO NOTHING;

-- Ø¨Ø¹Ø¯ÙŠÙ† Ø­Ø§ÙˆÙ„ ØªØ¶ÙŠÙ subscription Ù…Ù† Frontend
```

---

## ğŸ” Ø§Ù„ØªØ´Ø®ÙŠØµ (Ù„Ù„ØªØ£ÙƒØ¯):

### Ù†ÙÙ‘Ø° Ù‡Ø°Ø§ SQL:

```sql
-- ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù€ Tenant
SELECT * FROM tenants 
WHERE tenant_id = '0bf65997-ac37-40e2-b54d-1fe71d3dcb40';
```

**Ø§Ù„Ù†ØªÙŠØ¬Ø©:**
- âœ… **Ù„Ùˆ Ø·Ù„Ø¹ Ø³Ø·Ø± ÙˆØ§Ø­Ø¯** â†’ Tenant Ù…ÙˆØ¬ÙˆØ¯ (Ø§Ù„Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø´ÙŠ Ø«Ø§Ù†ÙŠ)
- âŒ **Ù„Ùˆ Ù…Ø§ Ø·Ù„Ø¹ Ø´ÙŠ** â†’ Tenant **Ù…Ø´ Ù…ÙˆØ¬ÙˆØ¯**! (Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¨Ø¨ 100%)

---

## ğŸ¯ Ø§Ù„Ø­Ù„ Ø§Ù„Ù…ÙˆØµÙ‰ Ø¨Ù‡:

### **Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù€ UI Ø¨Ø¯Ù„ SQL!**

#### Flow Ø§Ù„ØµØ­ÙŠØ­:

```
1. Tenants List
   â†“
2. Add New Tenant
   â†“
3. Ø§Ù…Ù„Ø£ ÙƒÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ„
   â†“
4. Save
   â†“
5. Ø§ÙØªØ­ Ø§Ù„Ù€ Tenant
   â†“
6. Subscriptions tab
   â†“
7. Add New Subscription
   â†“
8. âœ… ÙŠØ´ØªØºÙ„ Ø¨Ø¯ÙˆÙ† Ù…Ø´Ø§ÙƒÙ„!
```

---

## ğŸ“Š Ø§Ù„Ù€ Constraints Ø¹Ù„Ù‰ tenant_subscriptions:

```sql
-- Foreign Key Constraints:
1. tenant_id â†’ tenants(tenant_id)         â† Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ù‡Ù†Ø§!
2. created_by_id â†’ users(user_id)
3. updated_by_id â†’ users(user_id)

-- Unique Constraints (Ù…Ù…ÙƒÙ†):
- (tenant_id, system_code) UNIQUE  â† Ù…Ø´ÙƒÙ„Ø© Ù…Ø­ØªÙ…Ù„Ø© Ø«Ø§Ù†ÙŠØ©
```

---

## âš ï¸ Ø£Ø®Ø·Ø§Ø¡ Ø´Ø§Ø¦Ø¹Ø©:

### 1. Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥Ø¶Ø§ÙØ© Subscription Ù‚Ø¨Ù„ Ø¥Ù†Ø´Ø§Ø¡ Tenant
```
âŒ Ø§ÙØªØ­ URL Ù…Ø¨Ø§Ø´Ø±Ø©: /cms/tenants/uuid/details
âŒ Ø§Ù„Ù€ UUID Ù…Ø´ Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ database
âŒ 409 error!
```

### 2. Ø§Ø³ØªØ®Ø¯Ø§Ù… UUID Ø®Ø§Ø·Ø¦
```
âŒ UUID generated ÙÙŠ Frontend
âŒ Ù…Ø´ Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ database
âŒ 409 error!
```

### 3. Tenant ØªÙ… Ø­Ø°ÙÙ‡ (soft delete)
```sql
-- ØªØ­Ù‚Ù‚:
SELECT * FROM tenants 
WHERE tenant_id = 'uuid' 
AND is_deleted = false;  â† Ù…Ù‡Ù…!
```

---

## ğŸ¨ Ø§Ù„Ù€ UI Flow Ø§Ù„Ù…Ø«Ø§Ù„ÙŠ:

### Tenants List:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Tenants            [Add New] â†       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Name         Email        Country    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ UNHCR        ma@gmail.com Jordan     â”‚â† Ø§Ø¶ØºØ· Ù‡Ù†Ø§
â”‚ Red Cross    ...          USA        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Tenant Details â†’ Subscriptions Tab:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Subscriptions for UNHCR  [Add New] â† â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ System    Start      End      Price  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ (empty)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Add Subscription Modal:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Create Subscription                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ System Code:  [HR-SYSTEM____]        â”‚
â”‚ Start Date:   [2025-10-01___]        â”‚
â”‚ End Date:     [2025-10-31___]        â”‚
â”‚ Price:        [1000_________]        â”‚
â”‚ Notes:        [____________]         â”‚
â”‚ Active:       [â˜‘]                    â”‚
â”‚                                      â”‚
â”‚           [Cancel]  [Save]           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©:

### 1. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ù€ Backend Ø´ØºØ§Ù„:
```bash
# Terminal:
mvn spring-boot:run
```

### 2. Ø­Ø¯Ù‘Ø« Frontend:
```bash
Ctrl + R
```

### 3. Ø±ÙˆØ­ Ø¹Ù„Ù‰ Tenants List:
```
http://localhost:5173/cms/tenants
```

### 4. Ø¥Ø°Ø§ Ù…Ø§ ÙÙŠ Tenants:
```
Ø§Ø¶ØºØ· "Add New" ÙˆØ£Ù†Ø´Ø¦ ÙˆØ§Ø­Ø¯ Ø¬Ø¯ÙŠØ¯
```

### 5. Ø§ÙØªØ­ Ø§Ù„Ù€ Tenant:
```
Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ù€ row
```

### 6. Ø±ÙˆØ­ Ø¹Ù„Ù‰ Subscriptions tab

### 7. Ø§Ø¶ØºØ· "Add New"

### 8. Ø§Ù…Ù„Ø£ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:
```javascript
System Code: "HR-SYSTEM"  // Ù…Ø´ "Ø³ÙŠ" Ø£Ùˆ "fdd"
Start Date:  2025-10-01
End Date:    2025-10-31
Price:       1000
```

### 9. Ø§Ø¶ØºØ· Save

### 10. âœ… ÙŠØ¬Ø¨ ÙŠØ´ØªØºÙ„!

---

## ğŸ”§ Ø¥Ø°Ø§ Ù„Ø³Ù‡ Ù…Ø§ Ø§Ø´ØªØºÙ„:

### Ø§ÙØªØ­ Console (F12) ÙˆØ§Ø¨Ø­Ø« Ø¹Ù†:
```javascript
ğŸ“¦ Creating subscription with payload: {
  tenantId: "...",  â† Ø§Ù†Ø³Ø® Ù‡Ø°Ø§ UUID
  systemCode: "...",
  ...
}
```

### Ù†ÙÙ‘Ø° ÙÙŠ database:
```sql
-- Ø§Ø³ØªØ¨Ø¯Ù„ UUID:
SELECT * FROM tenants WHERE tenant_id = 'PASTE_HERE';
```

**Ø¥Ø°Ø§ Ù…Ø§ Ø·Ù„Ø¹ Ø´ÙŠ â†’ Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¨Ø¨!**

---

## ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…Ù‡Ù…Ø©:

1. **409 = Conflict** ÙŠØ¹Ù†ÙŠ Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ database constraints
2. Ø¥Ù…Ø§ **Foreign Key** (Ø§Ù„Ø£ÙƒØ«Ø± Ø§Ø­ØªÙ…Ø§Ù„Ø§Ù‹)
3. Ø£Ùˆ **Unique Constraint** (Ø£Ù‚Ù„ Ø§Ø­ØªÙ…Ø§Ù„Ø§Ù‹)
4. Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù€ UI flow Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ: List â†’ Add â†’ Details â†’ Subscriptions
5. **Ù„Ø§** ØªÙØªØ­ URL Ù…Ø¨Ø§Ø´Ø±Ø© Ø¨Ù€ UUID Ø¹Ø´ÙˆØ§Ø¦ÙŠ!

---

## âœ… Success Checklist:

- [ ] Backend Ø´ØºØ§Ù„
- [ ] Frontend Ù…Ø­Ø¯Ù‘Ø«
- [ ] Tenant Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ database
- [ ] Tenant **is_deleted = false**
- [ ] System Code ÙˆØ§Ø¶Ø­ (Ù…Ø«Ù„ "HR-SYSTEM")
- [ ] Dates ØµØ­ÙŠØ­Ø©
- [ ] Price Ø±Ù‚Ù… ØµØ­ÙŠØ­

---

**ğŸ‰ Ø¥Ø°Ø§ Ø§ØªØ¨Ø¹Øª Ø§Ù„Ø®Ø·ÙˆØ§ØªØŒ ÙŠØ¬Ø¨ ÙŠØ´ØªØºÙ„ 100%!**

**ğŸ“Œ Ø§Ù„Ø­Ù„ Ø§Ù„Ø£Ø³Ø±Ø¹: Ø£Ù†Ø´Ø¦ Tenant Ø¬Ø¯ÙŠØ¯ Ù…Ù† Tenants ListØŒ ÙˆØ£Ø¶Ù Subscription Ù…Ù† Details!**

